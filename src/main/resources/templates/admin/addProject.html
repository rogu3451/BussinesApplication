<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/adminNavbar :: html_head">
</head>
<body>
<div th:replace="admin/adminNavbar :: navbar"></div>
    <div class="container" style="min-height: 82.5vh;">

    <h3>Add new project.</h3>

    <form class="form-horizontal" th:object="${project}" th:action="@{/admin/addProject}" th:method="post">
        <div class="form-group">
            <label class="control-label">Name:</label>
            <input type="hidden" class="form-control" th:field="*{id}"/>
            <input type="text" class="form-control" th:field="*{name}"/>
            <p  class="alert alert-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"/>
        </div>
        <div class="form-group">
            <label class="control-label">Description:</label>
            <textarea type="text" class="form-control" rows="7" th:field="*{description}"/>
            <p class="alert alert-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"/>
        </div>

        <label class="control-label">Select customer who will be owner of the project:</label>
        <br>
        <select id="customers" class="form-control" th:field="*{customerId}">
        </select>
        <p class="alert alert-danger" th:if="${#fields.hasErrors('customerId')}" th:errors="*{customerId}"/>
        <p class="alert alert-danger" th:if="${customerDoesNotExist}" th:text="${customerDoesNotExist}"/>

        <p class="alert alert-success" th:if="${successMessage}" th:text="${successMessage}"/>
        <p class="alert alert-danger" th:if="${errorMessage}" th:text="${errorMessage}"/>
        <div class="row">
            <button type="submit" class="btn btn-default">Save</button>
        </div>

    </form>

        <button class="btn btn-default"> <a href="/admin/allProjects">Back</a></button>

    </div>
<div th:replace="footer :: footer"></div>
</body>
<script>
    $(document).ready(function () {
        getAllCustomersFromDB();
    })

    function getAllCustomersFromDB() {
        var urlAddress = window.location.protocol + "//" + window.location.host + "/admin/getAllCustomers";
        $.ajax({method: "GET", url: urlAddress})
            .done(function(responseJson){
                customersDropDown = $("#customers");
                if(responseJson.length == 0){
                    $('<option>').text("You don't have any customers in system.").appendTo(customersDropDown);
                }else{
                    $.each(responseJson, function (index, customer) {
                        //alert(index + ": " + customer.id + ": " + customer.firstName +": " + customer.lastName);
                        $('<option>').val(customer.id).text("ID: " + customer.id + " - " + customer.lastName +" "+ customer.firstName).appendTo(customersDropDown);
                    })
                }

            })
            .fail(function(){
                alert("Error connecting to the server");
            })
            .always(function (){
              //  alert("Always executed");
            });
    }
</script>
</html>
